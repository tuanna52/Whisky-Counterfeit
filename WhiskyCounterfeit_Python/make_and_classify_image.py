import matplotlib.pyplot as plt
from matplotlib.colors import ListedColormap

import numpy as np
import io
import sys
from PIL import Image

import tensorflow as tf
from tensorflow import keras

def make_and_classify_image(input_data):
    #Make numpy matrix from input
    input_data_list = list(map(int, input_data.split(',')))
    data_in = np.array(input_data_list)

    #Extract important sections of data and translate the data to the intended threshole
    onefifth_row1 = data_in[0:50]
    onefifth_row2 = data_in[400:450] + 5643
    onefifth_row3 = data_in[450:500] + 1478
    onefifth_row5 = data_in[1217:1267] + 10274

    onefifth_row1 = onefifth_row1[::-1]
    onefifth_row2 = onefifth_row2[::-1]
    onefifth_row3 = onefifth_row3[::-1]
    onefifth_row5 = onefifth_row5[::-1]

    #Make data rows
    row1 = np.concatenate((onefifth_row1,onefifth_row1,onefifth_row1,onefifth_row1,onefifth_row1), axis=None)
    row2 = np.concatenate((onefifth_row2,onefifth_row2,onefifth_row2,onefifth_row2,onefifth_row2), axis=None)
    row3 = np.concatenate((onefifth_row3,onefifth_row3,onefifth_row3,onefifth_row3,onefifth_row3), axis=None)
    row4 = data_in[740:990] + 21325
    row4 = row4[::-1]
    row5 = np.concatenate((onefifth_row5,onefifth_row5,onefifth_row5,onefifth_row5,onefifth_row5), axis=None)

    #Assemble the rows to create the matrix in order to make the images with scaled color
    imatrix = np.empty((5, 250), int)
    imatrix[0] = row1
    imatrix[1] = row2
    imatrix[2] = row3
    imatrix[3] = row4
    imatrix[4] = row5
    imatrix = imatrix.transpose()

    #Make colormap image from input data
    cmatrix = np.array([[0.000000, 0.000000, 0.000000, 1.000000], [1.000000, 0.000000, 0.000000, 1.000000], [1.000000, 0.013825, 0.000000, 1.000000], [1.000000, 0.027650, 0.000000, 1.000000], [1.000000, 0.041475, 0.000000, 1.000000], [1.000000, 0.055300, 0.000000, 1.000000], [1.000000, 0.069124, 0.000000, 1.000000], [1.000000, 0.082949, 0.000000, 1.000000], [1.000000, 0.096774, 0.000000, 1.000000], [1.000000, 0.110599, 0.000000, 1.000000], [1.000000, 0.124424, 0.000000, 1.000000], [1.000000, 0.138249, 0.000000, 1.000000], [1.000000, 0.152074, 0.000000, 1.000000], [1.000000, 0.165899, 0.000000, 1.000000], [1.000000, 0.179724, 0.000000, 1.000000], [1.000000, 0.193548, 0.000000, 1.000000], [1.000000, 0.207373, 0.000000, 1.000000], [1.000000, 0.221198, 0.000000, 1.000000], [1.000000, 0.235023, 0.000000, 1.000000], [1.000000, 0.248848, 0.000000, 1.000000], [1.000000, 0.262673, 0.000000, 1.000000], [1.000000, 0.276498, 0.000000, 1.000000], [1.000000, 0.290323, 0.000000, 1.000000], [1.000000, 0.304147, 0.000000, 1.000000], [1.000000, 0.317972, 0.000000, 1.000000], [1.000000, 0.331797, 0.000000, 1.000000], [1.000000, 0.345622, 0.000000, 1.000000], [1.000000, 0.359447, 0.000000, 1.000000], [1.000000, 0.373272, 0.000000, 1.000000], [1.000000, 0.387097, 0.000000, 1.000000], [1.000000, 0.400922, 0.000000, 1.000000], [1.000000, 0.414747, 0.000000, 1.000000], [1.000000, 0.428571, 0.000000, 1.000000], [1.000000, 0.442396, 0.000000, 1.000000], [1.000000, 0.456221, 0.000000, 1.000000], [1.000000, 0.470046, 0.000000, 1.000000], [1.000000, 0.483871, 0.000000, 1.000000], [1.000000, 0.497696, 0.000000, 1.000000], [1.000000, 0.511521, 0.000000, 1.000000], [1.000000, 0.525346, 0.000000, 1.000000], [1.000000, 0.539171, 0.000000, 1.000000], [1.000000, 0.552995, 0.000000, 1.000000], [1.000000, 0.566820, 0.000000, 1.000000], [1.000000, 0.580645, 0.000000, 1.000000], [1.000000, 0.594470, 0.000000, 1.000000], [1.000000, 0.608295, 0.000000, 1.000000], [1.000000, 0.622120, 0.000000, 1.000000], [1.000000, 0.635945, 0.000000, 1.000000], [1.000000, 0.649770, 0.000000, 1.000000], [1.000000, 0.663594, 0.000000, 1.000000], [1.000000, 0.677419, 0.000000, 1.000000], [1.000000, 0.691244, 0.000000, 1.000000], [1.000000, 0.705069, 0.000000, 1.000000], [1.000000, 0.718894, 0.000000, 1.000000], [1.000000, 0.732719, 0.000000, 1.000000], [1.000000, 0.746544, 0.000000, 1.000000], [1.000000, 0.760369, 0.000000, 1.000000], [1.000000, 0.774194, 0.000000, 1.000000], [1.000000, 0.788018, 0.000000, 1.000000], [1.000000, 0.801843, 0.000000, 1.000000], [1.000000, 0.815668, 0.000000, 1.000000], [1.000000, 0.829493, 0.000000, 1.000000], [1.000000, 0.843318, 0.000000, 1.000000], [1.000000, 0.857143, 0.000000, 1.000000], [1.000000, 0.870968, 0.000000, 1.000000], [1.000000, 0.884793, 0.000000, 1.000000], [1.000000, 0.898618, 0.000000, 1.000000], [1.000000, 0.912442, 0.000000, 1.000000], [1.000000, 0.926267, 0.000000, 1.000000], [1.000000, 0.940092, 0.000000, 1.000000], [1.000000, 0.953917, 0.000000, 1.000000], [1.000000, 0.967742, 0.000000, 1.000000], [1.000000, 0.981567, 0.000000, 1.000000], [1.000000, 0.995392, 0.000000, 1.000000], [0.990783, 1.000000, 0.000000, 1.000000], [0.976959, 1.000000, 0.000000, 1.000000], [0.963134, 1.000000, 0.000000, 1.000000], [0.949309, 1.000000, 0.000000, 1.000000], [0.935484, 1.000000, 0.000000, 1.000000], [0.921659, 1.000000, 0.000000, 1.000000], [0.907834, 1.000000, 0.000000, 1.000000], [0.894009, 1.000000, 0.000000, 1.000000], [0.880184, 1.000000, 0.000000, 1.000000], [0.866359, 1.000000, 0.000000, 1.000000], [0.852535, 1.000000, 0.000000, 1.000000], [0.838710, 1.000000, 0.000000, 1.000000], [0.824885, 1.000000, 0.000000, 1.000000], [0.811060, 1.000000, 0.000000, 1.000000], [0.797235, 1.000000, 0.000000, 1.000000], [0.783410, 1.000000, 0.000000, 1.000000], [0.769585, 1.000000, 0.000000, 1.000000], [0.755760, 1.000000, 0.000000, 1.000000], [0.741935, 1.000000, 0.000000, 1.000000], [0.728111, 1.000000, 0.000000, 1.000000], [0.714286, 1.000000, 0.000000, 1.000000], [0.700461, 1.000000, 0.000000, 1.000000], [0.686636, 1.000000, 0.000000, 1.000000], [0.672811, 1.000000, 0.000000, 1.000000], [0.658986, 1.000000, 0.000000, 1.000000], [0.645161, 1.000000, 0.000000, 1.000000], [0.631336, 1.000000, 0.000000, 1.000000], [0.617512, 1.000000, 0.000000, 1.000000], [0.603687, 1.000000, 0.000000, 1.000000], [0.589862, 1.000000, 0.000000, 1.000000], [0.576037, 1.000000, 0.000000, 1.000000], [0.562212, 1.000000, 0.000000, 1.000000], [0.548387, 1.000000, 0.000000, 1.000000], [0.534562, 1.000000, 0.000000, 1.000000], [0.520737, 1.000000, 0.000000, 1.000000], [0.506912, 1.000000, 0.000000, 1.000000], [0.493088, 1.000000, 0.000000, 1.000000], [0.479263, 1.000000, 0.000000, 1.000000], [0.465438, 1.000000, 0.000000, 1.000000], [0.451613, 1.000000, 0.000000, 1.000000], [0.437788, 1.000000, 0.000000, 1.000000], [0.423963, 1.000000, 0.000000, 1.000000], [0.410138, 1.000000, 0.000000, 1.000000], [0.396313, 1.000000, 0.000000, 1.000000], [0.382488, 1.000000, 0.000000, 1.000000], [0.368664, 1.000000, 0.000000, 1.000000], [0.354839, 1.000000, 0.000000, 1.000000], [0.341014, 1.000000, 0.000000, 1.000000], [0.327189, 1.000000, 0.000000, 1.000000], [0.313364, 1.000000, 0.000000, 1.000000], [0.299539, 1.000000, 0.000000, 1.000000], [0.285714, 1.000000, 0.000000, 1.000000], [0.271889, 1.000000, 0.000000, 1.000000], [0.258065, 1.000000, 0.000000, 1.000000], [0.244240, 1.000000, 0.000000, 1.000000], [0.230415, 1.000000, 0.000000, 1.000000], [0.216590, 1.000000, 0.000000, 1.000000], [0.202765, 1.000000, 0.000000, 1.000000], [0.188940, 1.000000, 0.000000, 1.000000], [0.175115, 1.000000, 0.000000, 1.000000], [0.161290, 1.000000, 0.000000, 1.000000], [0.147465, 1.000000, 0.000000, 1.000000], [0.133641, 1.000000, 0.000000, 1.000000], [0.119816, 1.000000, 0.000000, 1.000000], [0.105991, 1.000000, 0.000000, 1.000000], [0.092166, 1.000000, 0.000000, 1.000000], [0.078341, 1.000000, 0.000000, 1.000000], [0.064516, 1.000000, 0.000000, 1.000000], [0.050691, 1.000000, 0.000000, 1.000000], [0.036866, 1.000000, 0.000000, 1.000000], [0.023041, 1.000000, 0.000000, 1.000000], [0.009217, 1.000000, 0.000000, 1.000000], [0.000000, 1.000000, 0.004608, 1.000000], [0.000000, 1.000000, 0.018433, 1.000000], [0.000000, 1.000000, 0.032258, 1.000000], [0.000000, 1.000000, 0.046083, 1.000000], [0.000000, 1.000000, 0.059908, 1.000000], [0.000000, 1.000000, 0.073733, 1.000000], [0.000000, 1.000000, 0.087558, 1.000000], [0.000000, 1.000000, 0.101382, 1.000000], [0.000000, 1.000000, 0.115207, 1.000000], [0.000000, 1.000000, 0.129032, 1.000000], [0.000000, 1.000000, 0.142857, 1.000000], [0.000000, 1.000000, 0.156682, 1.000000], [0.000000, 1.000000, 0.170507, 1.000000], [0.000000, 1.000000, 0.184332, 1.000000], [0.000000, 1.000000, 0.198157, 1.000000], [0.000000, 1.000000, 0.211982, 1.000000], [0.000000, 1.000000, 0.225806, 1.000000], [0.000000, 1.000000, 0.239631, 1.000000], [0.000000, 1.000000, 0.253456, 1.000000], [0.000000, 1.000000, 0.267281, 1.000000], [0.000000, 1.000000, 0.281106, 1.000000], [0.000000, 1.000000, 0.294931, 1.000000], [0.000000, 1.000000, 0.308756, 1.000000], [0.000000, 1.000000, 0.322581, 1.000000], [0.000000, 1.000000, 0.336406, 1.000000], [0.000000, 1.000000, 0.350230, 1.000000], [0.000000, 1.000000, 0.364055, 1.000000], [0.000000, 1.000000, 0.377880, 1.000000], [0.000000, 1.000000, 0.391705, 1.000000], [0.000000, 1.000000, 0.405530, 1.000000], [0.000000, 1.000000, 0.419355, 1.000000], [0.000000, 1.000000, 0.433180, 1.000000], [0.000000, 1.000000, 0.447005, 1.000000], [0.000000, 1.000000, 0.460829, 1.000000], [0.000000, 1.000000, 0.474654, 1.000000], [0.000000, 1.000000, 0.488479, 1.000000], [0.000000, 1.000000, 0.502304, 1.000000], [0.000000, 1.000000, 0.516129, 1.000000], [0.000000, 1.000000, 0.529954, 1.000000], [0.000000, 1.000000, 0.543779, 1.000000], [0.000000, 1.000000, 0.557604, 1.000000], [0.000000, 1.000000, 0.571429, 1.000000], [0.000000, 1.000000, 0.585253, 1.000000], [0.000000, 1.000000, 0.599078, 1.000000], [0.000000, 1.000000, 0.612903, 1.000000], [0.000000, 1.000000, 0.626728, 1.000000], [0.000000, 1.000000, 0.640553, 1.000000], [0.000000, 1.000000, 0.654378, 1.000000], [0.000000, 1.000000, 0.668203, 1.000000], [0.000000, 1.000000, 0.682028, 1.000000], [0.000000, 1.000000, 0.695853, 1.000000], [0.000000, 1.000000, 0.709677, 1.000000], [0.000000, 1.000000, 0.723502, 1.000000], [0.000000, 1.000000, 0.737327, 1.000000], [0.000000, 1.000000, 0.751152, 1.000000], [0.000000, 1.000000, 0.764977, 1.000000], [0.000000, 1.000000, 0.778802, 1.000000], [0.000000, 1.000000, 0.792627, 1.000000], [0.000000, 1.000000, 0.806452, 1.000000], [0.000000, 1.000000, 0.820276, 1.000000], [0.000000, 1.000000, 0.834101, 1.000000], [0.000000, 1.000000, 0.847926, 1.000000], [0.000000, 1.000000, 0.861751, 1.000000], [0.000000, 1.000000, 0.875576, 1.000000], [0.000000, 1.000000, 0.889401, 1.000000], [0.000000, 1.000000, 0.903226, 1.000000], [0.000000, 1.000000, 0.917051, 1.000000], [0.000000, 1.000000, 0.930876, 1.000000], [0.000000, 1.000000, 0.944700, 1.000000], [0.000000, 1.000000, 0.958525, 1.000000], [0.000000, 1.000000, 0.972350, 1.000000], [0.000000, 1.000000, 0.986175, 1.000000], [0.000000, 1.000000, 1.000000, 1.000000], [0.000000, 0.986175, 1.000000, 1.000000], [0.000000, 0.972350, 1.000000, 1.000000], [0.000000, 0.958525, 1.000000, 1.000000], [0.000000, 0.944700, 1.000000, 1.000000], [0.000000, 0.930876, 1.000000, 1.000000], [0.000000, 0.917051, 1.000000, 1.000000], [0.000000, 0.903226, 1.000000, 1.000000], [0.000000, 0.889401, 1.000000, 1.000000], [0.000000, 0.875576, 1.000000, 1.000000], [0.000000, 0.861751, 1.000000, 1.000000], [0.000000, 0.847926, 1.000000, 1.000000], [0.000000, 0.834101, 1.000000, 1.000000], [0.000000, 0.820276, 1.000000, 1.000000], [0.000000, 0.806452, 1.000000, 1.000000], [0.000000, 0.792627, 1.000000, 1.000000], [0.000000, 0.778802, 1.000000, 1.000000], [0.000000, 0.764977, 1.000000, 1.000000], [0.000000, 0.751152, 1.000000, 1.000000], [0.000000, 0.737327, 1.000000, 1.000000], [0.000000, 0.723502, 1.000000, 1.000000], [0.000000, 0.709677, 1.000000, 1.000000], [0.000000, 0.695853, 1.000000, 1.000000], [0.000000, 0.682028, 1.000000, 1.000000], [0.000000, 0.668203, 1.000000, 1.000000], [0.000000, 0.654378, 1.000000, 1.000000], [0.000000, 0.640553, 1.000000, 1.000000], [0.000000, 0.626728, 1.000000, 1.000000], [0.000000, 0.612903, 1.000000, 1.000000], [0.000000, 0.599078, 1.000000, 1.000000], [0.000000, 0.585253, 1.000000, 1.000000], [0.000000, 0.571429, 1.000000, 1.000000], [0.000000, 0.557604, 1.000000, 1.000000], [0.000000, 0.543779, 1.000000, 1.000000], [0.000000, 0.529954, 1.000000, 1.000000], [0.000000, 0.516129, 1.000000, 1.000000], [0.000000, 0.502304, 1.000000, 1.000000], [0.000000, 0.488479, 1.000000, 1.000000], [0.000000, 0.474654, 1.000000, 1.000000], [0.000000, 0.460829, 1.000000, 1.000000], [0.000000, 0.447005, 1.000000, 1.000000], [0.000000, 0.433180, 1.000000, 1.000000], [0.000000, 0.419355, 1.000000, 1.000000], [0.000000, 0.405530, 1.000000, 1.000000], [0.000000, 0.391705, 1.000000, 1.000000], [0.000000, 0.377880, 1.000000, 1.000000], [0.000000, 0.364055, 1.000000, 1.000000], [0.000000, 0.350230, 1.000000, 1.000000], [0.000000, 0.336406, 1.000000, 1.000000], [0.000000, 0.322581, 1.000000, 1.000000], [0.000000, 0.308756, 1.000000, 1.000000], [0.000000, 0.294931, 1.000000, 1.000000], [0.000000, 0.281106, 1.000000, 1.000000], [0.000000, 0.267281, 1.000000, 1.000000], [0.000000, 0.253456, 1.000000, 1.000000], [0.000000, 0.239631, 1.000000, 1.000000], [0.000000, 0.225806, 1.000000, 1.000000], [0.000000, 0.211982, 1.000000, 1.000000], [0.000000, 0.198157, 1.000000, 1.000000], [0.000000, 0.184332, 1.000000, 1.000000], [0.000000, 0.170507, 1.000000, 1.000000], [0.000000, 0.156682, 1.000000, 1.000000], [0.000000, 0.142857, 1.000000, 1.000000], [0.000000, 0.129032, 1.000000, 1.000000], [0.000000, 0.115207, 1.000000, 1.000000], [0.000000, 0.101382, 1.000000, 1.000000], [0.000000, 0.087558, 1.000000, 1.000000], [0.000000, 0.073733, 1.000000, 1.000000], [0.000000, 0.059908, 1.000000, 1.000000], [0.000000, 0.046083, 1.000000, 1.000000], [0.000000, 0.032258, 1.000000, 1.000000], [0.000000, 0.018433, 1.000000, 1.000000], [0.000000, 0.004608, 1.000000, 1.000000], [0.009217, 0.000000, 1.000000, 1.000000], [0.023041, 0.000000, 1.000000, 1.000000], [0.036866, 0.000000, 1.000000, 1.000000], [0.050691, 0.000000, 1.000000, 1.000000], [0.064516, 0.000000, 1.000000, 1.000000], [0.078341, 0.000000, 1.000000, 1.000000], [0.092166, 0.000000, 1.000000, 1.000000], [0.105991, 0.000000, 1.000000, 1.000000], [0.119816, 0.000000, 1.000000, 1.000000], [0.133641, 0.000000, 1.000000, 1.000000], [0.147465, 0.000000, 1.000000, 1.000000], [0.161290, 0.000000, 1.000000, 1.000000], [0.175115, 0.000000, 1.000000, 1.000000], [0.188940, 0.000000, 1.000000, 1.000000], [0.202765, 0.000000, 1.000000, 1.000000], [0.216590, 0.000000, 1.000000, 1.000000], [0.230415, 0.000000, 1.000000, 1.000000], [0.244240, 0.000000, 1.000000, 1.000000], [0.258065, 0.000000, 1.000000, 1.000000], [0.271889, 0.000000, 1.000000, 1.000000], [0.285714, 0.000000, 1.000000, 1.000000], [0.299539, 0.000000, 1.000000, 1.000000], [0.313364, 0.000000, 1.000000, 1.000000], [0.327189, 0.000000, 1.000000, 1.000000], [0.341014, 0.000000, 1.000000, 1.000000], [0.354839, 0.000000, 1.000000, 1.000000], [0.368664, 0.000000, 1.000000, 1.000000], [0.382488, 0.000000, 1.000000, 1.000000], [0.396313, 0.000000, 1.000000, 1.000000], [0.410138, 0.000000, 1.000000, 1.000000], [0.423963, 0.000000, 1.000000, 1.000000], [0.437788, 0.000000, 1.000000, 1.000000], [0.451613, 0.000000, 1.000000, 1.000000], [0.465438, 0.000000, 1.000000, 1.000000], [0.479263, 0.000000, 1.000000, 1.000000], [0.493088, 0.000000, 1.000000, 1.000000], [0.506912, 0.000000, 1.000000, 1.000000], [0.520737, 0.000000, 1.000000, 1.000000], [0.534562, 0.000000, 1.000000, 1.000000], [0.548387, 0.000000, 1.000000, 1.000000], [0.562212, 0.000000, 1.000000, 1.000000], [0.576037, 0.000000, 1.000000, 1.000000], [0.589862, 0.000000, 1.000000, 1.000000], [0.603687, 0.000000, 1.000000, 1.000000], [0.617512, 0.000000, 1.000000, 1.000000], [0.631336, 0.000000, 1.000000, 1.000000], [0.645161, 0.000000, 1.000000, 1.000000], [0.658986, 0.000000, 1.000000, 1.000000], [0.672811, 0.000000, 1.000000, 1.000000], [0.686636, 0.000000, 1.000000, 1.000000], [0.700461, 0.000000, 1.000000, 1.000000], [0.714286, 0.000000, 1.000000, 1.000000], [0.728111, 0.000000, 1.000000, 1.000000], [0.741935, 0.000000, 1.000000, 1.000000], [0.755760, 0.000000, 1.000000, 1.000000], [0.769585, 0.000000, 1.000000, 1.000000], [0.783410, 0.000000, 1.000000, 1.000000], [0.797235, 0.000000, 1.000000, 1.000000], [0.811060, 0.000000, 1.000000, 1.000000], [0.824885, 0.000000, 1.000000, 1.000000], [0.838710, 0.000000, 1.000000, 1.000000], [0.852535, 0.000000, 1.000000, 1.000000], [0.866359, 0.000000, 1.000000, 1.000000], [0.880184, 0.000000, 1.000000, 1.000000], [0.894009, 0.000000, 1.000000, 1.000000], [0.907834, 0.000000, 1.000000, 1.000000], [0.921659, 0.000000, 1.000000, 1.000000], [0.935484, 0.000000, 1.000000, 1.000000], [0.949309, 0.000000, 1.000000, 1.000000], [0.963134, 0.000000, 1.000000, 1.000000], [0.976959, 0.000000, 1.000000, 1.000000], [0.990783, 0.000000, 1.000000, 1.000000], [1.000000, 0.000000, 0.995392, 1.000000], [1.000000, 0.000000, 0.981567, 1.000000], [1.000000, 0.000000, 0.967742, 1.000000], [1.000000, 0.000000, 0.953917, 1.000000], [1.000000, 0.000000, 0.940092, 1.000000], [1.000000, 0.000000, 0.926267, 1.000000], [1.000000, 0.000000, 0.912442, 1.000000], [1.000000, 0.000000, 0.898618, 1.000000], [1.000000, 0.000000, 0.884793, 1.000000], [1.000000, 0.000000, 0.870968, 1.000000], [1.000000, 0.000000, 0.857143, 1.000000], [1.000000, 0.000000, 0.843318, 1.000000], [1.000000, 0.000000, 0.829493, 1.000000], [1.000000, 0.000000, 0.815668, 1.000000], [1.000000, 0.000000, 0.801843, 1.000000], [1.000000, 0.000000, 0.788018, 1.000000], [1.000000, 0.000000, 0.774194, 1.000000], [1.000000, 0.000000, 0.760369, 1.000000], [1.000000, 0.000000, 0.746544, 1.000000], [1.000000, 0.000000, 0.732719, 1.000000], [1.000000, 0.000000, 0.718894, 1.000000], [1.000000, 0.000000, 0.705069, 1.000000], [1.000000, 0.000000, 0.691244, 1.000000], [1.000000, 0.000000, 0.677419, 1.000000], [1.000000, 0.000000, 0.663594, 1.000000], [1.000000, 0.000000, 0.649770, 1.000000], [1.000000, 0.000000, 0.635945, 1.000000], [1.000000, 0.000000, 0.622120, 1.000000], [1.000000, 0.000000, 0.608295, 1.000000], [1.000000, 0.000000, 0.594470, 1.000000], [1.000000, 0.000000, 0.580645, 1.000000], [1.000000, 0.000000, 0.566820, 1.000000], [1.000000, 0.000000, 0.552995, 1.000000], [1.000000, 0.000000, 0.539171, 1.000000], [1.000000, 0.000000, 0.525346, 1.000000], [1.000000, 0.000000, 0.511521, 1.000000], [1.000000, 0.000000, 0.497696, 1.000000], [1.000000, 0.000000, 0.483871, 1.000000], [1.000000, 0.000000, 0.470046, 1.000000], [1.000000, 0.000000, 0.456221, 1.000000], [1.000000, 0.000000, 0.442396, 1.000000], [1.000000, 0.000000, 0.428571, 1.000000], [1.000000, 0.000000, 0.414747, 1.000000], [1.000000, 0.000000, 0.400922, 1.000000], [1.000000, 0.000000, 0.387097, 1.000000], [1.000000, 0.000000, 0.373272, 1.000000], [1.000000, 0.000000, 0.359447, 1.000000], [1.000000, 0.000000, 0.345622, 1.000000], [1.000000, 0.000000, 0.331797, 1.000000], [1.000000, 0.000000, 0.317972, 1.000000], [1.000000, 0.000000, 0.304147, 1.000000], [1.000000, 0.000000, 0.290323, 1.000000], [1.000000, 0.000000, 0.276498, 1.000000], [1.000000, 0.000000, 0.262673, 1.000000], [1.000000, 0.000000, 0.248848, 1.000000], [1.000000, 0.000000, 0.235023, 1.000000], [1.000000, 0.000000, 0.221198, 1.000000], [1.000000, 0.000000, 0.207373, 1.000000], [1.000000, 0.000000, 0.193548, 1.000000], [1.000000, 0.000000, 0.179724, 1.000000], [1.000000, 0.000000, 0.165899, 1.000000], [1.000000, 0.000000, 0.152074, 1.000000], [1.000000, 0.000000, 0.138249, 1.000000], [1.000000, 0.000000, 0.124424, 1.000000], [1.000000, 0.000000, 0.110599, 1.000000], [1.000000, 0.000000, 0.096774, 1.000000], [1.000000, 0.000000, 0.082949, 1.000000], [1.000000, 0.000000, 0.069124, 1.000000], [1.000000, 0.000000, 0.055300, 1.000000], [1.000000, 0.000000, 0.041475, 1.000000], [1.000000, 0.000000, 0.027650, 1.000000], [1.000000, 0.000000, 0.013825, 1.000000]])
    color_map = ListedColormap(cmatrix)

    fig, ax = plt.subplots(figsize = (4,4), constrained_layout=True)
    psm = ax.pcolormesh(imatrix, cmap=color_map, rasterized=True, vmin=21897, vmax=25899)
    ax.set_axis_off()
    fig.colorbar(psm, ax=ax)
    ax.set_position([0, 0, 1.0, 1.0])
    fig.delaxes(fig.axes[1])

    buf = io.BytesIO()
    plt.savefig(buf, format='png')
    buf.seek(0)
    img = Image.open(buf).convert('RGB').resize((227, 227))
    buf.close()

    #Predict which class that the image belongs to
    class_names = ['s2510', 's2511', 's2512', 's2513', 's2514', 's2515', 's2516', 's2517', 's2518', 's2519', 's2520', 's2521', 's2522', 's2523', 's2525', 's2526', 's2527', 's2528', 's2529', 's2530', 's2531', 's2532', 's2533', 's2534', 's2535', 's2536', 's2537', 's2538', 's2539', 's2540', 's2541', 's2542', 's2543', 's2544', 's2545', 's2546', 's2547', 's2548', 's2549', 's2550', 's2551']

    #download whiskycounterfeit.h5 from this link: https://drive.google.com/file/d/1WX1rBGVbCQgaddSVOIkj_0de0cCVuQJ5/view?usp=sharing
    model = keras.models.load_model('whiskycounterfeit.h5')

    img_array = keras.preprocessing.image.img_to_array(img)
    img_array = tf.expand_dims(img_array, 0) # Create a batch

    predictions = model.predict(img_array)
    score = tf.nn.softmax(predictions[0])

    print(
        "@#@#This input data belongs to {} with a {:.2f} percent confidence.*&*&\n"
        .format(class_names[np.argmax(score)], 100 * np.max(score))
    )

if __name__ == '__main__':
    #Call the function with the input of command line argument
    make_and_classify_image(sys.argv[1])